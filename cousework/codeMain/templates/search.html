{% extends "base.html" %}

{% block title %}–ü–æ—à—É–∫: {{ query }} ‚Äì GamingLibrary{% endblock %}

{% block content %}
    <div class="max-w-7xl mx-auto px-4 py-12">
        <h1 class="text-4xl font-bold text-white mb-2">–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É</h1>
        <p class="text-xl text-gray-400 mb-8">–ó–∞ –∑–∞–ø–∏—Ç–æ–º: <span class="text-white font-medium">{{ query }}</span></p>

        {% if has_results %}
            <!-- Tabs –¥–ª—è —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è -->
            <div class="flex gap-4 mb-8">
                <button onclick="showTab('all')" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl transition active-tab" id="tab-all">–í—Å—ñ</button>
                <button onclick="showTab('games')" class="px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-xl transition" id="tab-games">–Ü–≥—Ä–∏</button>
                <button onclick="showTab('users')" class="px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-xl transition" id="tab-users">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</button>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ —ñ–≥—Ä–∞—Ö -->
            {% if games_results %}
                <section id="games-section" class="mb-16">
                    <h2 class="text-3xl font-bold text-white mb-6">–Ü–≥—Ä–∏</h2>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6">
                        {% for game in games_results %}
                            <a href="{% url 'game_detail' game.id %}"
                               class="group relative bg-gray-800/50 rounded-xl overflow-hidden border border-gray-700 hover:border-indigo-500 transition-all duration-300 cursor-pointer transform hover:scale-105">
                                <img src="{{ game.background_image|default:'https://via.placeholder.com/460x215?text=No+Image' }}"
                                     alt="{{ game.name }}" class="w-full h-64 object-cover">
                                <div class="p-4">
                                    <h3 class="text-white font-semibold text-sm truncate">{{ game.name }}</h3>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                </section>
            {% endif %}

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º -->
            {% if users_results %}
                <section id="users-section">
                    <h2 class="text-3xl font-bold text-white mb-6">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</h2>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6">
                        {% for user in users_results %}
                            <a href="{% url 'profile_by_username' user.username %}"
                               class="group bg-gray-800/70 rounded-2xl p-6 border border-gray-700 hover:border-indigo-500 transition-all duration-300 hover:scale-105 text-center">
                                <div class="w-24 h-24 mx-auto mb-4 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-4xl font-bold shadow-2xl">
                                    {{ user.username|slice:":1"|upper }}
                                </div>
                                <h3 class="text-white font-semibold text-lg truncate">{{ user.username }}</h3>
                                <p class="text-gray-400 text-sm">–î—Ä—É–∑—ñ–≤: {{ user.profile.friends.count }}</p>
                            </a>
                        {% endfor %}
                    </div>
                </section>
            {% endif %}
        {% else %}
            <div class="text-center py-20 text-gray-400">
                <div class="text-8xl mb-6">üîç</div>
                <p class="text-3xl font-medium mb-4">–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>
                <p class="text-xl">–°–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω—à–∏–π –∑–∞–ø–∏—Ç –∞–±–æ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–æ–ø–∏—Å</p>
            </div>
        {% endif %}
    </div>

    <script>
        function showTab(tab) {
            const gamesSection = document.getElementById('games-section');
            const usersSection = document.getElementById('users-section');

            // –°–∫–∏–¥–∞—î–º–æ —Å—Ç–∏–ª—ñ –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('button[id^="tab-"]').forEach(btn => btn.classList.replace('bg-indigo-600', 'bg-gray-700'));
            document.getElementById(`tab-${tab}`).classList.replace('bg-gray-700', 'bg-indigo-600');

            if (tab === 'all') {
                if (gamesSection) gamesSection.style.display = 'block';
                if (usersSection) usersSection.style.display = 'block';
            } else if (tab === 'games') {
                if (gamesSection) gamesSection.style.display = 'block';
                if (usersSection) usersSection.style.display = 'none';
            } else if (tab === 'users') {
                if (gamesSection) gamesSection.style.display = 'none';
                if (usersSection) usersSection.style.display = 'block';
            }
        }
    </script>
{% endblock %}