generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(cuid())
  username  String    @unique
  email     String    @unique
  password  String
  avatar    String?   @default("https://api.dicebear.com/7.x/initials/svg?seed=User")
  createdAt DateTime  @default(now())

  games     UserGame[]
  reviews   Review[]
  friends   Friend[]  @relation("UserFriends")
  friendOf  Friend[]  @relation("FriendOf")

  @@map("users")
}

model UserGame {
  id       String  @id @default(cuid())
  userId   String
  gameId   Int
  status   String  @default("У планах")
  rating   Int?
  review   String?
  addedAt  DateTime @default(now())

  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, gameId])
  @@map("user_games")
}

model Review {
  id        String   @id @default(cuid())
  userId    String
  gameId    Int
  text      String
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, gameId])
  @@map("reviews")
}

model Friend {
  userId    String
  friendId  String
  createdAt DateTime @default(now())

  user      User @relation("UserFriends", fields: [userId], references: [id])
  friend    User @relation("FriendOf", fields: [friendId], references: [id])

  @@id([userId, friendId])
  @@map("friends")
}